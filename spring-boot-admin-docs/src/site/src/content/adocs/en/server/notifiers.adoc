= Notifiers =

Notifiers can be used to push status changes of applications or instances to a defined channel.
Beside the build in notifiers listed below, custom notifiers can be implemented.
[[build-in-notifiers]]

== Build in Notifiers ==

[[mail-notifications]]
=== Mail Notifications ===

Mail notifications will be delivered as HTML emails rendered using https://www.thymeleaf.org/[Thymeleaf] templates.
To enable Mail notifications, configure a `JavaMailSender` using `spring-boot-starter-mail` and set a recipient.

.Sample Mail Notification

image::{base-path}/mail-notification-sample.png[Sample Mail Notification]

NOTE: To prevent disclosure of sensitive information, the default mail template doesn't show any metadata of
the instance. If you want to you show some of the metadata you can use a custom template.

. Add spring-boot-starter-mail to your dependencies:
+
[source,xml]
.pom.xml
----
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-mail</artifactId>
</dependency>
----

. Configure a JavaMailSender
+
.application.properties
----
spring.mail.host=smtp.example.com
spring.boot.admin.notify.mail.to=admin@example.com
----

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.mail,leveloffset=+1]

[[pagerduty-notifications]]
=== PagerDuty Notifications ===
To enable https://www.pagerduty.com/[PagerDuty] notifications you just have to add a generic service to your PagerDuty-account and set `spring.boot.admin.notify.pagerduty.service-key` to the service-key you received.

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.pagerduty,leveloffset=+1]

[[opsgenie-notifications]]
=== OpsGenie Notifications ===
To enable https://www.opsgenie.com/[OpsGenie] notifications you just have to add a new JSON Rest API integration to your OpsGenie account and set `spring.boot.admin.notify.opsgenie.api-key` to the apiKey you received.

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.opsgenie,leveloffset=+1]

[[hipchat-notifications]]
=== Hipchat Notifications ===
To enable https://www.hipchat.com/[Hipchat] notifications you need to create an API token on your Hipchat account and set the appropriate configuration properties.

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.hipchat,leveloffset=+1]

[[slack-notifications]]
=== Slack Notifications ===
To enable https://slack.com/[Slack] notifications you need to add a incoming Webhook under custom integrations on your Slack
account and configure it appropriately.

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.slack,leveloffset=+1]


[[letschat-notifications]]
=== Let\'s Chat Notifications ===
To enable https://sdelements.github.io/lets-chat/[Let's Chat] notifications you need to add the host url and add the API token and username from Let's Chat

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.letschat,leveloffset=+1]


[[ms-teams-notifications]]
=== Microsoft Teams Notifications ===
To enable Microsoft Teams notifications you need to setup a connector webhook url and set the appropriate configuration property.

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.ms-teams,leveloffset=+1]


[[telegram-notifications]]
=== Telegram Notifications ===
To enable https://telegram.org/[Telegram] notifications you need to create and authorize a telegram bot and set the appropriate configuration properties for auth-token and chat-id.

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.telegram,leveloffset=+1]


[[discord-notifications]]
=== Discord Notifications ===
To enable Discord notifications you need to create a webhook and set the appropriate configuration property.

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.discord,leveloffset=+1]


[[DingTalk-notifications]]
=== DingTalk Notifications ===
To enable https://www.dingtalk.com/[DingTalk] notifications you need to create and authorize a dingtalk bot and set the appropriate configuration properties for webhookUrl and secret.

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.dingtalk,leveloffset=+1]


[[RocketChat-notifications]]
=== RocketChat Notifications ===
To enable https://www.rocket.chat/[Rocket.Chat] notifications you need a personal token access and create a room to send message with this token

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.rocketchat,leveloffset=+1]


[[notification-proxy]]
== Notification Proxy Settings
All Notifiers which are using a `RestTemplate` can be configured to use a proxy.

include::{samples-dir}/../spring-boot-admin-docs/target/aggregated-adoc.adoc[tag=spring.boot.admin.notify.proxy,leveloffset=+1]


[[filtering-notifications]]
== Filtering Notifications
The `FilteringNotifier` allows you to filter certain notification based on rules you can add/remove at runtime. It delegates the sending of notifications to another notifier.

If you add a `FilteringNotifier` to your `ApplicationContext` a RESTful interface on `notifications/filter` gets available.

This notifier is useful if you don't want receive notifications when deploying your applications. Before stopping the application you can add an (expiring) filter either via a `POST` request.

.How to configure filtering
[source,java,indent=0]
----
include::{samples-dir}/spring-boot-admin-sample-servlet/src/main/java/de/codecentric/boot/admin/NotifierConfig.java[tags=configuration-filtering-notifier]
----
<1> Add the `FilteringNotifier` bean using a delegate (e.g. `MailNotifier` when configured)
<2> Add the `RemindingNotifier` as primary bean using the `FilteringNotifier` as delegate.

TIP: This example combines the reminding and filtering notifiers. This allows you to get notifications after the deployed application hasn't restarted in a certain amount of time (until the filter expires).

[[customizing-notifiers]]
== Custom Notifiers ==

You can add your own Notifiers by adding Spring Beans which implement the `Notifier` interface, at best by extending
`AbstractEventNotifier` or `AbstractStatusChangeNotifier`.

[source,java,indent=0]
----
include::{samples-dir}/spring-boot-admin-sample-servlet/src/main/java/de/codecentric/boot/admin/CustomNotifier.java[tags=customization-notifiers]
----

[[reminder-notifications]]
== Notification Reminder
The `RemindingNotifier` sends reminders for down/offline applications, it delegates the sending of notifications to another notifier.

By default a reminder is triggered when a registered application changes to `DOWN` or `OFFLINE`. You can alter this behaviour via `setReminderStatuses()`. The reminder ends when either the status changes to a non-triggering status or the regarding application gets deregistered.

By default the reminders are sent every 10 minutes, to change this use `setReminderPeriod()`. The `RemindingNotifier` itself doesn't start the background thread to send the reminders, you need to take care of this as shown in the given example below;

.How to configure reminders
[source,java]
----
@Configuration
public class NotifierConfiguration {
    @Autowired
    private Notifier notifier;

    @Primary
    @Bean(initMethod = "start", destroyMethod = "stop")
    public RemindingNotifier remindingNotifier() {
        RemindingNotifier notifier = new RemindingNotifier(notifier, repository);
        notifier.setReminderPeriod(Duration.ofMinutes(10)); // <1>
        notifier.setCheckReminderInverval(Duration.ofSeconds(10)); //<2>
        return notifier;
    }
}
----
<1> The reminders will be sent every 10 minutes.
<2> Schedules sending of due reminders every 10 seconds.
